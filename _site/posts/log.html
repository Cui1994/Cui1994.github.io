<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="description" content="为Spring Boot添加日志模块 - 崔金涛个人博客 - 作者:崔金涛"/> 
	<meta name="keywords" content="spring boot,java"/>
    <title>为Spring Boot添加日志模块 - 崔金涛个人博客</title>
    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Custom CSS -->
    <link href="/css/blog.css" rel="stylesheet"/>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media
    queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file://
    -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js">
      </script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js">
      </script>
    <![endif]-->
        <!-- jQuery Version 1.11.0 -->
    <script src="/js/jquery-1.11.0.js"> </script>
    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>
  </head>
  
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">
              Toggle navigation
            </span>
            <span class="icon-bar">
            </span>
            <span class="icon-bar">
            </span>
            <span class="icon-bar">
            </span>
          </button>
          <a class="navbar-brand" href="/">
            首页
          </a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          		<ul class="nav navbar-nav">
			
				<li>
				  <a href="/posts/work.html">
					工作经验
				  </a>
				</li>
			
				<li>
				  <a href="/posts/study.html">
					学习笔记
				  </a>
				</li>
			
				<li>
				  <a href="/posts/other.html">
					随笔
				  </a>
				</li>
			
		</ul>  
        </div>
        <!-- /.navbar-collapse -->
      </div>
      <!-- /.container -->
    </nav>
    <!-- Page Content -->
    <div class="container">
      <div class="row">
        <!-- Blog Entries Column -->
        <div class="col-md-8">
          <!-- Navi -->
<a href="/">首页</a>&nbsp;>&nbsp;<a href="/posts/work.html">工作经验</a>&nbsp;>&nbsp;正文
<!-- Title -->
<h2>为Spring Boot添加日志模块</h2>
<b>标签：</b><a href="/tags.html#spring boot"><i>spring boot</i></a>, <a href="/tags.html#java"><i>java</i></a>
<div class="post-date">
	<span class="glyphicon glyphicon-time"></span>
	2017-06-29
</div>
<br/>

<!-- content -->
<div style="text-indent:2em;">
<h1 id="概述">概述</h1>
<p>SLF4J——Simple Logging Facade For Java，它是一个针对于各类Java日志框架的统一Facade抽象。Java日志框架众多——常用的有java.util.logging, log4j, logback，commons-logging, Spring框架使用的是Jakarta Commons Logging API (JCL)。而SLF4J定义了统一的日志抽象接口，而真正的日志实现则是在运行时决定的——它提供了各类日志框架的binding。</p>

<p>Logback是log4j框架的作者开发的新一代日志框架，它效率更高、能够适应诸多的运行环境，同时天然支持SLF4J。</p>

<p>默认情况下，Spring Boot会用Logback来记录日志，并用INFO级别输出到控制台。</p>

<h1 id="配置">配置</h1>

<h2 id="添加依赖">添加依赖</h2>

<p>一般来说需要添加spring-boot-starter-logging：</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>

<p>实际开发并不需要直接添加依赖，spring-boot-starter其中包含了 spring-boot-starter-logging，该依赖内容就是 Spring Boot 默认的日志框架 logback。而Thymeleaf依赖包含了spring-boot-starter，最终我只要引入Thymeleaf即可。</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>

<h2 id="自定义日志配置">自定义日志配置</h2>

<p>添加好依赖后原则上讲就可以开始使用日志模块了，但使用的是Spring Boot提供的很多默认配置，在<code>application.properties</code>中也只能修改部分属性，往往不能满足需求，因此需要自行定制配置文件实现日志配置。</p>

<p>Spring Boot官方推荐优先使用带有-spring的文件名作为你的日志配置（如使用logback-spring.xml，而不是logback.xml），命名为logback-spring.xml的日志配置文件，spring boot可以为它添加一些spring boot特有的配置项。</p>

<p>在<code>src/main/resources</code>路径下添加<code>logback-spring.xml</code>作为日志配置文件：</p>
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration  scan="true" scanPeriod="60 seconds" debug="false"&gt;
    &lt;contextName&gt;logback&lt;/contextName&gt;
    &lt;property name="log.path" value="C:\\Users\\cuijintao\\logback.log" /&gt;
    &lt;!--输出到控制台--&gt;
    &lt;appender name="console" class="ch.qos.logback.core.ConsoleAppender"&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;!--输出到文件--&gt;
    &lt;appender name="file" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
        &lt;file&gt;${log.path}&lt;/file&gt;
        &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;
            &lt;fileNamePattern&gt;C:\\Users\\cuijintao\\logback.%d{yyyy-MM-dd_HH-mm}.log&lt;/fileNamePattern&gt;
            &lt;maxHistory&gt;20&lt;/maxHistory&gt;
            &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt;
        &lt;/rollingPolicy&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;root level="info"&gt;
        &lt;appender-ref ref="console" /&gt;
        &lt;appender-ref ref="file" /&gt;
    &lt;/root&gt;

    &lt;!-- logback为java中的包 --&gt;
    &lt;logger name="com.example.demo"/&gt;
    &lt;!--logback.LogbackDemo：类的全路径 --&gt;
    &lt;logger name="com.example.hello" level="WARN" additivity="false"&gt;
        &lt;appender-ref ref="file"/&gt;
    &lt;/logger&gt;
&lt;/configuration&gt;
</code></pre>

<h3 id="根节点configuration属性">根节点<code>&lt;configuration&gt;</code>属性</h3>

<ul>
  <li>scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true。</li>
  <li>scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒。当scan为true时，此属性生效。默认的时间间隔为1分钟。</li>
  <li>debug:当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false。</li>
</ul>

<h4 id="属性1---上下文名称contextname">属性1 - 上下文名称<code>&lt;contextName&gt;</code>:</h4>
<p>每个logger都关联到logger上下文，默认上下文名称为“default”。
之后可以通过%contextName来打印日志上下文名称。</p>
<pre><code>&lt;contextName&gt;logback&lt;/contextName&gt;
</code></pre>

<h4 id="属性2---属性变量property">属性2 - 属性变量<code>&lt;property&gt;</code></h4>
<p>定义一个key-value键值对
通过定义的值会被插入到logger上下文中。定义变量后，可以使“${}”来使用变量。</p>
<pre><code> &lt;property name="log.path" value="C:\\Users\\cuijintao\\logback.log" /&gt;
</code></pre>

<h4 id="子节点1---appender">子节点1 - <code>&lt;appender&gt;</code></h4>
<p>appender用来格式化日志输出节点，有俩个属性name和class，class用来指定哪种输出策略，常用就是控制台输出策略和文件输出策略。</p>

<p><code>&lt;encoder&gt;</code>表示对日志进行编码：</p>
<ul>
  <li><code>%d{HH: mm:ss.SSS}</code> : 日志输出时间</li>
  <li><code>%thread</code> : 日志输出进程名字</li>
  <li><code>%-5level</code>: 日志级别 TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</li>
  <li><code>%logger{36}</code> : 日志输出者名字</li>
  <li><code>%msg</code>: 日志消息</li>
  <li><code>%n</code>:　平台换行符</li>
</ul>

<p>输出到文件时，RollingFileAppender用于切分文件日志：</p>
<pre><code>    &lt;!--输出到文件--&gt;
    &lt;appender name="file" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
        &lt;file&gt;${log.path}&lt;/file&gt;
        &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;
            &lt;fileNamePattern&gt;C:\\Users\\cuijintao\\logback.%d{yyyy-MM-dd_HH-mm}.log&lt;/fileNamePattern&gt;
            &lt;maxHistory&gt;20&lt;/maxHistory&gt;
            &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt;
        &lt;/rollingPolicy&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;
</code></pre>

<ul>
  <li><code>&lt;fileNamePattern&gt;</code>: 指定日志的切分方式</li>
  <li><code>&lt;maxHistory&gt;</code>: 指定保留的切分文件的个数</li>
  <li><code>&lt;totalSizeCap&gt;</code>: 指定日志文件的上限大小，超过此值将会被删除</li>
</ul>

<h4 id="子节点2---root">子节点2 - <code>&lt;root&gt;</code></h4>
<p>必选节点，用来指定最基础的日志输出级别，只有一个level属性。
默认值为DEBUG.</p>
<pre><code>&lt;root level="debug"&gt;
  &lt;appender-ref ref="console" /&gt;
  &lt;appender-ref ref="file" /&gt;
&lt;/root&gt;
</code></pre>

<h4 id="子节点3---loger">子节点3 - <code>&lt;loger&gt;</code></h4>
<p><code>&lt;loger&gt;</code>用来设置某一个包或者具体的某一个类的日志打印级别、以及指定<code>&lt;appender&gt;</code>。
仅有一个name属性，一个可选的level和一个可选的addtivity属性。</p>

<ul>
  <li><code>name</code>: 用来指定受此loger约束的某一个包或者具体的某一个类。</li>
  <li><code>level</code>: 日志级别</li>
  <li><code>addtivity</code>: 是否向上级loger传递打印信息。默认是true。</li>
</ul>

<h4 id="多环境日志输出">多环境日志输出</h4>
<p>据不同环境（prod:生产环境，test:测试环境，dev:开发环境）来定义不同的日志输出，在 logback-spring.xml中使用 springProfile 节点来定义，方法如下：</p>

<pre><code>&lt;!-- 测试环境+开发环境. 多个使用逗号隔开. --&gt;
&lt;springProfile name="test,dev"&gt;
    &lt;logger name="com.dudu.controller" level="info" /&gt;
&lt;/springProfile&gt;
&lt;!-- 生产环境. --&gt;
&lt;springProfile name="prod"&gt;
    &lt;logger name="com.dudu.controller" level="ERROR" /&gt;
&lt;/springProfile&gt;
</code></pre>

<p>在启动或打包服务是配置profile参数即可。
如启动时指定prod的方式为：</p>
<pre><code>java -jar xxx.jar --spring.profiles.active=prod
</code></pre>

<h1 id="demo">demo</h1>
<p>这里启动一个hello world的spring-boot模板来测试日志配置。</p>
<pre><code>package com.example.demo.com.example.demo.hello;

import org.springframework.web.bind.annotation.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@RestController
public class HelloController {

    private Logger logger = LoggerFactory.getLogger(this.getClass());

    @RequestMapping("/hello")
    public String index() {

        logger.info("日志测试 info");
        logger.debug("日志测试 debug");

        return "Hello World";
    }

}
</code></pre>
<p>根据上面的配置，日志文件中只记录了INFO级别的日志，每分钟对日志文件进行了切分。</p>


</div>

<br/>
<b>原创文章，转载请注明出处！</b>
<br/>
<b>本文链接：</b><a href="http://localhost:4000/posts/log.html" title="">http://localhost:4000/posts/log.html</a>

<!-- next and previous -->
<div style="margin-top:15px; margin-bottom:10px">
  
  <span class="next">
    上篇：
    <a href="/posts/mule.html">
      通过MULE实现后端服务调用
    </a>
  </span>
   
  
</div>
<hr>
<!-- Blog Comments -->
<div class="media">
   
</div>
        </div>
        <!-- Blog Sidebar Widgets Column -->
        <div class="col-md-4">
          <!-- Blog Categories Well -->
          <div class="well">
            <h4>
              栏目分类
            </h4>
            <div class="row">
                            <div class="col-lg-6">
                <ul class="list-unstyled">
                  <li>
                    <a href="/posts/work.html">
                      工作经验
                    </a>
                  </li>
                  <li>
                    <a href="/posts/study.html">
                      学习笔记
                    </a>
                  </li>
                  <li>
                    <a href="/posts/other.html">
                      随笔
                    </a>
                  </li>
                  <li>
                    <a href="/archives.html">
                      存档
                    </a>
                  </li>
                </ul>
              </div>
 
 
            </div>
            <!-- /.row -->
          </div>
		  <!-- Blog Recent Well -->
          <div class="well">
            <h4>
              最新文章
            </h4>
			<div class="row">
                            <div class="col-lg-12">
                <ul class="list-unstyled">
				
                  <li>
                    <a href="/posts/log.html">
                      为Spring Boot添加日志模块
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/mule.html">
                      通过MULE实现后端服务调用
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/bmpn.html">
                      BPMN2.0概念
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/socketio.html">
                      利用flask_socketio实现与前段的socket通信
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/shejimoshi.html">
                      大话设计模式Python实现
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/iter.html">
                      Python的迭代器，可迭代对象和生成器
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/git.html">
                      Pro Git整理
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/sicp.html">
                      SICP
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/rabbitmq.html">
                      RabbitMQ泛式
                    </a>
                  </li>
				
                  <li>
                    <a href="/posts/redis.html">
                      再看redis
                    </a>
                  </li>
				  
                </ul>
              </div> 
			</div>
          </div>
        </div>
      </div>
      <!-- /.row -->

      <!-- Footer -->
      <footer>
        <div class="row">
          <div class="col-lg-12">
                        <div style="text-align:center;margin-top:15px;">
				Copyright &copy; cuijintao.github.io, generated by Jekyll
				<br/>
            </div>
 
          </div>
          <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
      </footer>
    </div>
    <!-- /.container -->
  </body>

</html>
